---
import Layout from "@/layouts/Layout.astro";
import redditPosts from "@/data/reddit.json";

// âœ… This function must be exported at the top level
export async function getStaticPaths() {
  return redditPosts.map((post) => {
    const slug = post.image.split("/").pop()?.replace(/\.(jpg|jpeg|png|webp|gif)/, "");
    return {
      params: { slug },
    };
  });
}

// Define expected post type
type Post = {
  title: string;
  image: string;
  url: string;
  body?: string;
};

const { slug } = Astro.params;
const post = redditPosts.find(p => slug && p.image.includes(slug)) as Post;

if (!post) {
  throw new Error(`Post not found for slug: ${slug}`);
}
---
