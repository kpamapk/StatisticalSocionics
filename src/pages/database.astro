---
import Layout from "@/layouts/Layout.astro";
import redditPosts from "@/data/reddit.json";
const posts = redditPosts;
---

<Layout>
  <main class="px-4 max-w-3xl mx-auto py-10">
    <h1 class="text-3xl font-bold mb-6">Database</h1>

    <!-- 🔍 Search Input -->
    <input
      id="search"
      type="text"
      placeholder="Search posts..."
      class="w-full px-4 py-2 mb-6 border border-gray-300 rounded"
    />

    <!-- 🔁 Filtered Posts will appear here -->
    <div id="results" class="grid gap-6 sm:grid-cols-2">
      {posts.map(post => (
        <a href={post.url} target="_blank" rel="noopener" class="block border rounded-md overflow-hidden hover:shadow-lg transition post-card">
          <img src={post.image} alt={post.title} class="w-full object-cover max-h-64" loading="lazy" />
          <div class="p-3 text-sm font-medium">{post.title}</div>
        </a>
      ))}
    </div>
  </main>
</Layout>

<!-- 🧠 Client-side JS -->
<script>
  document.addEventListener("astro:page-load", () => {
    const input = document.getElementById("search") as HTMLInputElement | null;
    if (!input) return;

    input.addEventListener("input", () => {
      const query = input.value.toLowerCase();
      const cards = document.querySelectorAll(".post-card");

      cards.forEach(card => {
        const el = card as HTMLElement;
        const title = el.textContent?.toLowerCase() ?? "";
        el.style.display = title.includes(query) ? "block" : "none";
      });
    });
  });
</script>

